={% extends "base.html" %}

{% block content %}
<h2>Assign Cover for {{ leave_request.requesting_user.full_name }} ({{ leave_request.start_date }} - {{ leave_request.end_date }})</h2>

<form method="post" class="mt-4">
    {{ form.hidden_tag() }}

    {% set current_date = None %}
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th>Date</th>
                <th>Subject</th>
                <th>Year Group</th>
                <th>Cover Teacher</th>
            </tr>
        </thead>
        <tbody>
            {% for slot_form, slot_detail in zip(form.slots, slot_details) %}
                {% if current_date != slot_detail['date'] %}
                    <tr>
                        <td colspan="5" class="font-weight-bold">
                            <h4>{{ slot_detail['date'] }}</h4>
                        </td>
                    </tr>
                    {% set current_date = slot_detail['date'] %}
                {% endif %}
                <tr>
                    <td>
                        {{ loop.index }}
                    </td>
                    <td>{{ slot_detail['date'] }}</td>
                    <td>{{ slot_detail['subject'] }}</td>
                    <td>{{ slot_detail['year_group'] }}</td>
                    <td>
                        {{ slot_form.covering_teacher(class="form-control") }}

                        <!-- Display errors, if any -->
                        {% if slot_form.covering_teacher.errors %}
                            <div class="text-danger mt-1">
                                {{ slot_form.covering_teacher.errors[0] }}
                            </div>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="submit" class="btn btn-primary">Save Assignments</button>
</form>
{% endblock %}